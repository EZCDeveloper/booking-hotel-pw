---
trigger: manual
---

# ✨ Playwright and TypeScript for Big Projects  ✨

Guidelines for writing robust, clear, maintainable tests using Playwright with TypeScript.

Template:

tests/
├── .auth/                 # Directory for saved authentication state (playwright)
├── .env.prod              # Environment variables for Production
├── .env.staging           # Environment variables for Staging
├── .gitignore             # Files and folders ignored by Git
├── fixtures/              # Playwright fixtures definition
│   ├── data/              # Test data
│   │   ├── apiHotel-data.ts
│   │   ├── test-copy.ts
│   │   ├── test-data.ts
│   │   └── url-copy.ts
│   ├── images/            # Images used in tests (if applicable)
│   └── myFixtures/        # Custom or extended fixtures
│       └── allFixtures.ts
├── node_modules/          # Project dependencies
├── package-lock.json      # Exact versions of dependencies
├── package.json           # Project metadata and dependencies
├── playwright-report/     # Reports generated by Playwright
├── playwright.config.ts   # Main Playwright configuration file
├── support/               # Utility functions/classes and Page Object Models
│   ├── auth/              # Authentication-related logic
│   │   └── user-roles.ts
│   ├── helpers/           # Utility functions/classes
│   │   ├── hotelApiHelper.ts # Helper for API calls related to hotels
│   │   └── testDataGenerator.ts # Test data generation
│   └── pages/             # Page Object Model classes
│       ├── authentication/
│       │   └── login.page.ts
│       ├── base/
│       │   └── base.page.ts
│       ├── hotel/
│       │   ├── createHotel.page.ts
│       │   └── myHotels.page.ts
│       └── searchHotel/
│           └── searchHotel.page.ts
├── test-results/          # Test execution results
├── tests/                 # Test cases
│   ├── api/               # API tests
│   │   ├── apiHotel.test.ts
│   │   └── apiUser.test.ts
│   ├── regression/        # Regression tests
│   │   ├── authentication.test.ts
│   │   ├── book_hotel.test.ts
│   │   ├── login.setup.ts
│   │   ├── manage_hotel.test.ts
│   │   └── search_hotel.test.ts
│   ├── sanity/            # Sanity tests
│   │   └── sanity.test.ts
│   └── smoke/             # Smoke tests
│       └── smoke.test.ts
└── tsconfig.json          # TypeScript configuration
```

### 1. Core Principles

- **Self-Documentation:** Tests should be self-descriptive through `test.describe` and `test` blocks with clear and concise names.
- **Comments:** Use comments only for complex logic, non-obvious configurations, or to explain the "why" of a design decision, not the "what". TypeScript types and descriptive names should cover the "what".
- **Atomicity:** Each test should focus on verifying a specific behavior or flow.

### 2. Test Structure

- **Playwright Fixtures:**
    - Use fixtures for test data, Page Object instances, API contexts, or any repetitive setup/teardown.
    - Leverage fixture scope (`test` or `worker`).
- **Waits and Retries:**
    - Rely on Playwright's built-in retry mechanisms and auto-waiting (web-first assertions).
    - **Avoid `page.waitForTimeout()`** for arbitrary waits. Use locators and assertions that wait automatically (e.g., `expect(locator).toBeVisible()`).
- **DO NOT** harcode in test files. Use `/fixtures/data/*.ts` for custom data or `/support/helpers/*.ts` for Utility functions.

### 3. Element Selection (Locators) and Assertions

- **Locator Priority (as recommended by Playwright):**
    1. **By Role (User-facing):** `page.getByRole()` (e.g., `page.getByRole('button', { name: 'Sign In' })`).
    2. **By Text (User-facing):** `page.getByText()` (for visible text).
    3. **By Label (User-facing):** `page.getByLabel()` (for form elements).
    4. **By Placeholder (User-facing):** `page.getByPlaceholder()`.
    5. **By Test ID:** `page.getByTestId('my-test-id')` (configure the attribute in `playwright.config.ts` or use `page.locator('[data-testid="..."]')`). This is an excellent practice for robust selectors.
- **Avoid Brittle Selectors:** Similar to Cypress, avoid selectors based on very generic CSS classes or visual styles, or overly specific DOM structures.
- **Assertions (with Playwright's `expect`):** Write concise and meaningful assertions.

### 4. API Testing and Interactions (`APIRequestContext`)

- **Usage:** To set up state (create data, authenticate), verify endpoints, or for dedicated API tests.
- **Obtaining:**
    - Playwright provides an `request` fixture of type `APIRequestContext`.
    - A new context can be created with `playwright.request.newContext({ baseURL: '...' })`.
- **API Authentication:** Configure `APIRequestContext` with tokens, cookies, or necessary headers (e.g., in `playwright.config.ts` or when creating the context).
- **Typing:** Use interfaces/types for API payloads and responses.

### 5. TypeScript Usage

- **Explicit Types:** Use types for all variables, parameters, and function returns.
- **Interfaces and Types (`type` / `interface`):** Define structures for complex objects (POMs, fixture data, API payloads).
- **`async/await`:** Mandatory for all asynchronous Playwright operations.
- **Enums:** For sets of constants (e.g., user roles, states).

### 6. Guidelines for Code Analysis (by AI)

Before suggesting changes:

1. **Check Existing Patterns:** Review the codebase to understand and follow already established patterns and conventions.
2. **Review Implementations:** Understand the functionality of existing Page Objects, fixtures, and utilities before proposing duplicates or alternatives.
3. **Respect Functional Code:** If the code works and follows consistent patterns (even if not "ideal" according to these guidelines), be cautious with suggestions for massive refactoring without clear benefit.
4. **Do Not Assume Missing Functionality:** Verify if functionality already exists before proposing its creation.

### 7. Version Compatibility: Avoid using deprecated methods or syntax. Consult Playwright's changelogs.